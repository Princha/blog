<html>

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge;" />
    <title><%= lang.setting_title %></title>
    <link rel="stylesheet" type="text/css" href="/statics/css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="/statics/css/bootstrap-theme.min.css">
    <link rel="stylesheet" type="text/css" href="/statics/css/bootstrap-validator.min.css"> 
    <!-- <link rel="stylesheet" type="text/css" href="./css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="./css/bootstrap-theme.min.css">
    <link rel="stylesheet" type="text/css" href="./css/bootstrap-validator.min.css"> -->
    <link rel="stylesheet" type="text/css" href="./css/style.css">
    <script type="text/javascript" src="./js/base-loading.js"></script>
    <style>
        /* body {
            margin: 16px;
        } */

        #list-view th {
            padding: 5px 8px;
            border-bottom: 2px solid #ddd;
        }

        #list-view td {
            padding: 5px 8px;
            border-bottom: 1px solid #ddd;
        }

        #tools {
            margin-bottom: 16px;
        }

        #dialog {
            position: fixed;
            background: rgba(255, 255, 255, 0.8);
            top: 0px;
            bottom: 0px;
            left: 0px;
            right: 0px;
            *padding: 64px;
        }

        #serviceStateOn {
            width: 10px;
            height: 10px;
            margin: 0 auto;
            background-color: #1E90FF
        }

        #serviceStateRed {
            width: 10px;
            height: 10px;
            margin: 0 auto;
            background-color: #ff0000
        }

        #serviceStateOff {
            width: 10px;
            height: 10px;
            margin: 0 auto;
            background-color: #222222
        }

        #dialog-inner {
            background: #FFF;
            border: 1px solid #CCC;
            width: 600px;
            height: 100%;
            margin: 0px auto;
            box-shadow: 5px 5px 5px #CCC;
        }

        #version {
            font-size: 16px;
            color: rgba(150, 150, 150, 0.8);
            /*border: 2px solid rgb(81, 150, 180);*/
        }

        .config-dialog-body span {
            min-width: 160px;
            line-height: 44px;
            display: inline-block;
        }

        .config-dialog-body button {
            margin-top: 10px;
            margin-bottom: 10px;
        }
    </style>
</head>

<body>
    <nav class="navbar navbar-default">
        <div class="container-fluid">
            <div class="navbar-header">
                <span class="navbar-brand"><%= lang.setting_title %></span>
            </div>
        </div>
    </nav>
        <!-- <h2 style="height:50px;">Gateway Settings</h2> -->
    <!-- <div style="padding-left:16px;"> -->
        <!-- <div style="width:400px;margin-top:4%;margin-left:2%"> -->
    <div class="container">
        <div class="panel panel-default">
            <div class="panel-heading">
                <h3 class="panel-title"><%= lang.setting_panel_title %> - <%= lang.setting_last_modified_label %> : <span id="last-modified-span"></span></h3>
            </div>
            <div class="panel-body">
                <form id="setting-form" class="form-horizontal" role="form">
                    <div class="form-group">
                        <label for="http_col_url_input" class="col-sm-3 control-label"><%= lang.setting_http_col_url_label %>:</label>
                        <div class="col-sm-8">
                            <input id="http_col_url_input" class="form-control" name="http_col_url_input" placeholder="<%= lang.setting_colserip_input_placeholder %>" />
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="coap_col_url_input" class="col-sm-3 control-label"><%= lang.setting_coap_col_url_label %>:</label>
                        <div class="col-sm-8">
                            <input id="coap_col_url_input" class="form-control" name="coap_col_url_input" placeholder="<%= lang.setting_colserip_input_placeholder %>" />
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="register_interval_input" class="col-sm-3 control-label"><%= lang.setting_register_interval_label %>:</label>
                        <div class="col-sm-8">
                            <div class="input-group">
                                <input id="register_interval_input" class="form-control" name="register_interval_input" type="text" placeholder="<%= lang.setting_register_interval_input_placeholder %>" />
                                <span class="input-group-addon">S</span>
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="heartbeat_interval_input" class="col-sm-3 control-label"><%= lang.setting_heartbeat_interval_label %>:</label>
                        <div class="col-sm-8">
                            <div class="input-group">
                                <input id="heartbeat_interval_input" class="form-control" name="heartbeat_interval_input" placeholder="<%= lang.setting_heartbeat_interval_input_placeholder %>" />
                                <span class="input-group-addon">S</span>
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="datapush_interval_input" class="col-sm-3 control-label"><%= lang.setting_datapush_interval_label %>:</label>
                        <div class="col-sm-8">
                            <div class="input-group">
                                <input id="datapush_interval_input" class="form-control" name="datapush_interval_input" placeholder="<%= lang.setting_datapush_interval_input_placeholder %>" />
                                <span class="input-group-addon">S</span>
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <div class="col-sm-12">
                            <button type="button" class="btn btn-default center-block" onclick="set_config()"><%= lang.setting_form_submit %></button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
    <!-- <script type="text/javascript" src="/statics/js/jquery.min.js"></script>
    <script type="text/javascript" src="/statics/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="/statics/js/bootstrap-validator.min.js"></script> -->
    <script type="text/javascript" src="./js/jquery.min.js"></script>
    <script type="text/javascript" src="./js/bootstrap.min.js"></script>
    <script type="text/javascript" src="./js/bootstrap-validator.min.js"></script>
    <script type="text/javascript" src="./js/utils.js"></script>
    <script>
        $(document).ready(function () {
            $.get('./device/setting', function (result, status) {
                if (result.result == 0) {
                    console.log(result);
                    $('#http_col_url_input').val(result.data.http_url || '');
                    $('#coap_col_url_input').val(result.data.coap_url || '');
                    $('#register_interval_input').val(result.data.register_interval || '');
                    $('#heartbeat_interval_input').val(result.data.heartbeat_interval || '');
                    $('#datapush_interval_input').val(result.data.datapush_interval || '');
                    // $('#last-modified-span').text(result.data.last_modified || '');
                    $('#last-modified-span').text(new Date(result.data.last_modified).toLocaleString().replace(/:\d{1,2}$/,' ') || '');
                    
                } else {
                    // parent.location.reload();
                }
            });
            $('#setting-form').bootstrapValidator({
                message: 'This value is not valid',
                live: 'enable',
                feedbackIcons: {
                    // valid: 'glyphicon glyphicon-ok',
                    invalid: 'glyphicon glyphicon-remove',
                    validating: 'glyphicon glyphicon-refresh'
                },
                fields: {
                    http_col_url_input: {
                        // message: '用户名验证失败',
                        validators: {
                            notEmpty: {
                                message: 'Can not be empty'
                            }
                        }
                    },
                    coap_col_url_input: {
                        validators: {
                            notEmpty: {
                                message: 'Can not be empty'
                            }
                        }
                    },
                    register_interval_input: {
                        validators: {
                            notEmpty: {
                                message: 'Can not be empty'
                            },
                            numeric:{
                                message: 'It must be number'
                            }
                        }
                    },
                    heartbeat_interval_input: {
                        validators: {
                            notEmpty: {
                                message: 'Can not be empty'
                            },
                            numeric:{
                                message: 'It must be number'
                            }
                        }
                    },
                    datapush_interval_input: {
                        validators: {
                            notEmpty: {
                                message: 'Can not be empty'
                            },
                            numeric:{
                                message: 'It must be number'
                            }
                            // callback:{
                            //     callback:function(value, validator, $field){
                            //         if($field.val() < 0 || $field.val() > 23){
                            //             return { valid: false, message: 'The range must be between 0 and 23' };
                            //         }else{
                            //             return { valid: true };
                            //         }
                            //     }
                            // }
                            // validate: function (validator, $field, options) {
                            //     
                            // }
                        }
                    }
                }
            });
        });
        function set_config() {
            var bootstrapValidator = $('#setting-form').data('bootstrapValidator');
            bootstrapValidator.validate();
            if (bootstrapValidator.isValid()) {
                var body = {};
                body.http_url = $('#http_col_url_input').val();
                body.coap_url = $('#coap_col_url_input').val();
                body.register_interval = $('#register_interval_input').val();
                body.heartbeat_interval = $('#heartbeat_interval_input').val();
                body.datapush_interval = $('#datapush_interval_input').val();
                $.post('./device/setting', body, function (data) {
                    if(data.result == 0){
                        window.alert('设置提交成功');
                        console.log('set config success');
                        window.location.reload();
                    }
                    else if(data.result == 1){
                        window.alert('没有相关权限');
                        console.log('set config fail, no power');
                    }
                    else{
                        console.log('set config fail, no login');
                        parent.location.reload();
                    }
                })
            } else {
                // console.log('not ok');
            }
        }
    </script>
</body>

</html>